@using SistemaRentabilidad.Models
@model SistemaRentabilidad.ViewModels.WsVM
@{
    ViewBag.Title = "Editar Planilla";
}
<style>
    #resumentabla td {
        line-height: 15px;
    }

    #nueva td {
        line-height: 15px;
    }

    #ingresotabla td {
        line-height: 15px;
    }

    #encabezadostabla td {
        line-height: 15px;
    }

    #costotabla td {
        line-height: 15px;
    }

    #gastotabla td {
        line-height: 15px;
    }

    #otrotabla td {
        line-height: 15px;
    }

    #ingresotabla th {
        line-height: 15px;
    }

    #costotabla th {
        line-height: 15px;
    }

    #gastotabla th {
        line-height: 15px;
    }

    #otrotabla th {
        line-height: 15px;
    }

    #nueva th {
        line-height: 15px;
    }

    #resumentabla th {
        line-height: 15px;
    }

    #otrosub th {
        line-height: 15px;
    }

    #encabezadostabla th {
        line-height: 15px;
    }

    #totalingresotabla th {
        line-height: 15px;
    }

    #totalgastotabla th {
        line-height: 15px;
    }

    #totalcostotabla th {
        line-height: 15px;
    }

    #totalotrotabla th {
        line-height: 15px;
    }



    .table {
        margin-bottom: 0px;
    }
</style>
@Html.HiddenFor(model => model.IdWorksheet)

<head>

    <link href="/Content/site.css" rel="stylesheet">
</head>
<input id="idw" value="@Model.IdWorksheet"/>
@*///////////////////////////*@
<hr style="margin-top: 10px;margin-bottom: 10px;" />

<legend style="margin-bottom: 2px;">
    Planilla: @Html.DisplayFor(model => model.IdWorksheet)
</legend>
<table id="titulotabla" class="table table-condensed table-bordered chica">

    <thead class="tableStyle">


        <tr class="text-center">
            <th class="text-center">
                Descripción
            </th>

            <th class="text-center">
                Fecha de creación
            </th>
        </tr>
    </thead>
    <tbody>

    <td class="text-center">
        @Html.TextBoxFor(model => model.WorksheetDescription)
   </td>
    <td class="text-center">
@Html.TextBoxFor(model => model.Date)    </td>
    </tbody>

</table>
<hr style="margin-top: 2px;margin-bottom: 5px;border-style: dashed" />

<legend style="margin-bottom: 2px;background: cadetblue">
    Linea
</legend>
<table id="nueva" class="table table-condensed table-bordered chica" style="margin-bottom: 10px">
    <thead>
        <tr class="text-center" style="background: gainsboro">
            <th class="text-left" style="width: 40%">
                Descripción
            </th>
            <th class="text-left" style="width: 40%">
                Observación
            </th>

            <th class="text-left">
                Monto
            </th>
            <th class="text-center">
                Tipo
            </th>
        </tr>
    </thead>
    <tbody id="nueva">
    <td class="text-center fina">
        <input type="text" class="panel-info form-control-sm inputForm" id="ndescription" placeholder="" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td class="text-center fina">
        <input type="text" class="panel-info form-control-sm inputForm" id="ncomment" placeholder="" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td class="fina">
        <input type="number" class="panel-info form-control-sm inputForm" style="width: 100px" value="1" id="namount" onkeypress="solonumerosptocoma();" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td>
        <div class="btn-group btn-group-justified" data-toggle="buttons" style="display: inline">
            <label class="btn btn-info btn-xs active" value="ing" onclick="acting(this)">
                <input type="radio" name="options" value="ing" onclick="acttipo(this)" autocomplete="off" checked>Ingreso
            </label>
            <label class="btn btn-info btn-xs" value="cos" onclick="actcos(this)">
                <input type="radio" name="options" value="cos" autocomplete="off">Costo
            </label>
            <label class="btn btn-info btn-xs" value="gas" onclick="actgas(this)">
                <input type="radio" name="options" value="gas" autocomplete="off">Gasto
            </label>
            <label class="btn btn-info btn-xs" value="otr" onclick="actotr(this)">
                <input type="radio" name="options" value="otr" autocomplete="off">Otro ing.
            </label>
        </div>
    </td>
    <td class="fina">
        <button type="button" id="addn" class="btn btn-success btn-xs add" value="nueva" />
        <span class="glyphicon glyphicon-plus"></span>
    </td>
    </tbody>

</table>
<hr style="margin-top: 2px; margin-bottom: 5px; border-style: inset; border-width: thin;"/>
<table id="encabezadostabla" class="table table-condensed table-bordered chica" style="margin-bottom: 2px">
    <thead>
        <tr class="text-center" style="background: khaki">
            <th class="text-left" style="width: 40%">
                Descripción
            </th>
            <th class="text-left" style="width: 40%">
                Observación
            </th>

            <th class="text-left" style="width: 20%">
                Monto
            </th>

        </tr>
    </thead>
</table>
<hr style="margin-top: 2px;margin-bottom: 5px;border-style: dotted" />
<legend style="margin-bottom: 2px; background: darkkhaki">
    Ingresos
</legend>

<table id="ingresotabla" class="table table-condensed table-bordered chica">

    <tbody id="ingreso">
    <tr>
        <td style="width: 40%; line-height: 10px">-</td>
        <td style="width: 40%; line-height: 10px">-</td>
        <td style="line-height: 10px">-</td>
    </tr>
@foreach (var item in Model.Sheets)
{
    if (item.SheetType == SheetType.Ingreso) { 

    <tr>
        <td style="width: 40%;">
            @Html.TextBoxFor(modelItem => item.SheetDescription, new { @id = "iteming_SheetDescription" + @item.IdSheet,Name="ing_SheetDescription"})


        </td>
        <td style="width: 40%;">
            @Html.TextBoxFor(modelItem => item.Comments, new { @id = "iteming_Comments" + @item.IdSheet, Name = "ing_Comments" })
        </td>
        <td>
            @Html.TextBoxFor(modelItem => item.Amount, new { @id = "iteming_Amount" + @item.IdSheet, Name = "ing_Amount" })


        </td>
    </tr>}
}
    </tbody>

</table>
<table id="totalingresotabla" class="table table-condensed table-bordered chica" style="margin-bottom: 10px">
    <thead>
        <tr class="text-center" style="background: none">
            <th class="text-left" style="width: 40%; border-bottom: hidden; border-top: hidden;border-left:hidden">

            </th>
            <th class="text-right" style="width: 40%; font-weight: bolder;border-bottom: hidden; border-top: hidden; border-left: hidden;font-style: italic;font-size: medium;">
                Subtotal
            </th>

            <th class="text-left" style="background: lightgray" id="toting">
                @Html.TextBoxFor(model => model.Totali)
            </th>
            <th style="width: 2%;border-bottom: hidden; border-top: hidden;border-right:hidden">

            </th>

        </tr>
    </thead>
</table>
<hr style="margin-top: 2px; margin-bottom: 5px; border-style: dashed"/>

<legend style="margin-bottom: 2px;background: darkkhaki">
    Costos de las ventas
</legend>
<table id="costotabla" class="table table-condensed table-bordered chica">

    <tbody id="costo">
    <tr>
        <td style="width: 40%; line-height: 10px">-</td>
        <td style="width: 40%; line-height: 10px">-</td>
        <td style="line-height: 10px">-</td>
    </tr>
        @foreach (var item in Model.Sheets)
        {
            if (item.SheetType == SheetType.Costo)
            {

                <tr>
                    <td style="width: 40%;">
                        @Html.TextBoxFor(modelItem => item.SheetDescription, new {@id = "itemcos_SheetDescription" + @item.IdSheet, Name = "cos_SheetDescription"})


                    </td>
                    <td style="width: 40%;">
                        @Html.TextBoxFor(modelItem => item.Comments, new {@id = "itemcos_Comments" + @item.IdSheet, Name = "cos_Comments"})
                    </td>
                    <td>
                        @Html.TextBoxFor(modelItem => item.Amount, new {@id = "itemcos_Amount" + @item.IdSheet, Name = "cos_Amount"})


                    </td>
                </tr>
            }
        }
    </tbody>

</table>
<table id="totalcostotabla" class="table table-condensed table-bordered chica" style="margin-bottom: 10px">
    <thead>
        <tr class="text-center" style="background: none">
            <th class="text-left" style="width: 40%; border-bottom: hidden; border-top: hidden;border-left:hidden">

            </th>
            <th class="text-right" style="width: 40%; font-weight: bolder;border-bottom: hidden; border-top: hidden; border-left: hidden;font-style: italic;font-size: medium;">
                Subtotal
            </th>

            <th class="text-left" style="background: lightgray" id="totcos">
                @Html.TextBoxFor(model => model.Totalc)
            </th>
            <th style="width: 2%;border-bottom: hidden; border-top: hidden;border-right:hidden">

            </th>

        </tr>
    </thead>
</table>
<hr style="margin-top: 2px; margin-bottom: 5px; border-style: dashed"/>

<legend style="margin-bottom: 2px;background: darkkhaki">
    Gastos
</legend>
<table id="gastotabla" class="table table-condensed table-bordered chica">

    <tbody id="gasto">
    <tr>
        <td style="width: 40%; line-height: 10px">-</td>
        <td style="width: 40%; line-height: 10px">-</td>
        <td style="line-height: 10px">-</td>
    </tr>
        @foreach (var item in Model.Sheets)
        {
            if (item.SheetType == SheetType.Gasto) {
                <tr>
                    <td style="width: 40%;">
                        @Html.TextBoxFor(modelItem => item.SheetDescription, new {@id = "itemgas_SheetDescription" + @item.IdSheet, Name = "gas_SheetDescription"})
                        
                    </td>
                    <td style="width: 40%;">
                        @Html.TextBoxFor(modelItem => item.Comments, new {@id = "itemgas_Comments" + @item.IdSheet, Name = "gas_Comments"})
                    </td>
                    <td>
                        @Html.TextBoxFor(modelItem => item.Amount, new {@id = "itemgas_Amount" + @item.IdSheet, Name = "gas_Amount"})


                    </td>
                </tr>
            }
        }
    </tbody>

</table>
<table id="totalgastotabla" class="table table-condensed table-bordered chica" style="margin-bottom: 10px">
    <thead>
        <tr class="text-center" style="background: none">
            <th class="text-left" style="width: 40%; border-bottom: hidden; border-top: hidden;border-left:hidden">

            </th>
            <th class="text-right" style="width: 40%; font-weight: bolder;border-bottom: hidden; border-top: hidden; border-left: hidden;font-style: italic;font-size: medium;">
                Subtotal
            </th>

            <th class="text-left" style="background: lightgray" id="totgas">
                @Html.TextBoxFor(model => model.Totalg)
            </th>
            <th style="width: 2%;border-bottom: hidden; border-top: hidden;border-right:hidden">

            </th>

        </tr>
    </thead>
</table>
<hr style="margin-top: 2px; margin-bottom: 5px; border-style: dashed"/>
<legend style="margin-bottom: 2px;background: darkkhaki">
    Otros ingresos
</legend>
<table id="otrotabla" class="table table-condensed table-bordered chica">

    <tbody id="otro">
    <tr>
        <td style="width: 40%; line-height: 10px">-</td>
        <td style="width: 40%; line-height: 10px">-</td>
        <td style="line-height: 10px">-</td>
    </tr>
        @foreach (var item in Model.Sheets)
        {
            if (item.SheetType == SheetType.OtroIngreso)
            {

                <tr>
                    <td style="width: 40%;">
                        @Html.TextBoxFor(modelItem => item.SheetDescription, new {@id = "itemotr_SheetDescription" + @item.IdSheet, Name = "otr_SheetDescription"})


                    </td>
                    <td style="width: 40%;">
                        @Html.TextBoxFor(modelItem => item.Comments, new {@id = "itemotr_Comments" + @item.IdSheet, Name = "otr_Comments"})
                    </td>
                    <td>
                        @Html.TextBoxFor(modelItem => item.Amount, new {@id = "itemotr_Amount" + @item.IdSheet, Name = "otr_Amount"})


                    </td>
                </tr>
            }
        }
    </tbody>
</table>
<table id="totalotrotabla" class="table table-condensed table-bordered chica" style="margin-bottom: 10px">
    <thead>
        <tr class="text-center" style="background: none">
            <th class="text-left" style="width: 40%; border-bottom: hidden; border-top: hidden;border-left:hidden">

            </th>
            <th class="text-right" style="width: 40%; font-weight: bolder;border-bottom: hidden; border-top: hidden; border-left: hidden;font-style: italic;font-size: medium;">
                Subtotal
            </th>

            <th class="text-left" style="background: lightgray" id="tototr">
                @Html.TextBoxFor(model => model.Totalo)
            </th>
            <th style="width: 2%;border-bottom: hidden; border-top: hidden;border-right:hidden">

            </th>

        </tr>
    </thead>
</table>

<hr style="margin-top: 2px; margin-bottom: 5px; border-style: dashed"/>
<legend style="margin-bottom: 2px;background: darkkhaki">
    Resumen
</legend>
<table id="resumentabla" class="table table-condensed   table-striped table-bordered chica">

    <thead class="tableStyle">
        <tr class="text-center" style="background: khaki">
            <td class="text-left" style="border-radius: 3px; font-weight: bold">
                Observaciones
            </td>
            <td class="text-left" style="border-radius: 3px; width: 200px; font-weight: bold">
                Total
            </td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                @Html.TextBoxFor(model => model.Comments)


            </td>
            <td>
                @Html.TextBoxFor(model => model.TotalAmount)
                <span class="text-danger" style="display: block"></span>
            </td>
        </tr>

    </tbody>

</table>

<hr style="color: grey"/>
<div class="text-center">
    <button type="button" id="guardar" class="btn btn-success btn-md" value="Guardar">
        Guardar
        <span class="glyphicon glyphicon-floppy-disk"></span>
    </button>


</div>
@section Scripts{
    <script>

        $('#guardar').click(function() {
            bootbox.confirm("** Está por confirmar la edición, ¿Desea continuar?", function(result1) {

                if (result1) {
                    orderItems = [];

                    itemsi = [];
                    itemsidescriptions = [];
                    itemsicomments = [];
                    itemsiamounts = [];

                    itemsc = [];
                    itemscdescriptions = [];
                    itemsccomments = [];
                    itemscamounts = [];

                    itemsg = [];
                    itemsgdescriptions = [];
                    itemsgcomments = [];
                    itemsgamounts = [];

                    itemso = [];
                    itemsodescriptions = [];
                    itemsocomments = [];
                    itemsoamounts = [];

                    $("input[name='ing_SheetDescription']").map(function () { itemsidescriptions.push((this.value)) });
                    $("input[name='ing_Comments']").map(function () { itemsicomments.push((this.value)) });
                    $("input[name='ing_Amount']").map(function () { itemsiamounts.push(parseFloat(this.value)) });

                    $("input[name='cos_SheetDescription']").map(function () { itemscdescriptions.push((this.value)) });
                    $("input[name='cos_Comments']").map(function () { itemsccomments.push((this.value)) });
                    $("input[name='cos_Amount']").map(function () { itemscamounts.push(parseFloat(this.value)) });

                    $("input[name='gas_SheetDescription']").map(function () { itemsgdescriptions.push((this.value)) });
                    $("input[name='gas_Comments']").map(function () { itemsgcomments.push((this.value)) });
                    $("input[name='gas_Amount']").map(function () { itemsgamounts.push(parseFloat(this.value)) });

                    $("input[name='otr_SheetDescription']").map(function () { itemsodescriptions.push((this.value)) });
                    $("input[name='otr_Comments']").map(function () { itemsocomments.push((this.value)) });
                    $("input[name='otr_Amount']").map(function () { itemsoamounts.push(parseFloat(this.value)) });


                    for (i = 0; i < itemsidescriptions.length; i++) {

                        itemsi.push({
                            SheetDescription: itemsidescriptions[i],
                            Comments: itemsicomments[i],
                            Amount: itemsiamounts[i],
                            SheetType: 0
                            
                        });
                    }

                    for (i = 0; i < itemscdescriptions.length; i++) {

                        itemsc.push({
                            SheetDescription: itemscdescriptions[i],
                            Comments: itemsccomments[i],
                            Amount: itemscamounts[i],
                            SheetType: 1

                        });
                    }
                    for (i = 0; i < itemsgdescriptions.length; i++) {

                        itemsg.push({
                            SheetDescription: itemsgdescriptions[i],
                            Comments: itemsgcomments[i],
                            Amount: itemsgamounts[i],
                            SheetType: 2

                        });
                    }
                    for (i = 0; i < itemsodescriptions.length; i++) {

                        itemso.push({
                            SheetDescription: itemsodescriptions[i],
                            Comments: itemsocomments[i],
                            Amount: itemsoamounts[i],
                            SheetType: 3

                        });
                    }
                    orderItems = $.merge(itemsi, itemsc);
                    orderItems = $.merge(orderItems, itemsg);
                    orderItems = $.merge(orderItems, itemso);

                    var data = {
                        IdWorkSheet: $('#idw').val().trim(),
                        WorksheetDescription: $('#WorksheetDescription').val().trim(),
                        Date: $('#Date').val().trim(),
                        Comments: $('#Comments').val().trim(),
                        Sheets: orderItems,
                        Totali: $('#Totali').val().trim(),
                        Totalc: $('#Totalc').val().trim(),
                        Totalg: $('#Totalg').val().trim(),
                        Totalo: $('#Totalo').val().trim(),
                        TotalAmount: $('#TotalAmount').val().trim()
                    }
                    $.ajax({
                        url: '@Url.Action("EditW", "Worksheets")',
                        type: "POST",
                        data: JSON.stringify(data),
                        dataType: "JSON",
                        contentType: "application/json",
                        success: function (d) {
                            //check is successfully save to database
                            if (d.status == true) {
                            
                                var url = '@Url.Action("Details", "Worksheets", new {id = ViewBag.nuevo})';
                                window.location.href = url;
                            } else {
                                alert('Failed');
                            }
                            $('#submit').val('Save');
                        },
                        error: function () {
                            alert('Error. Please try again.');
                            $('#submit').val('Save');
                        }
                    });
                }


            });


        });


    </script>




}