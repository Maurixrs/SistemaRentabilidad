
@{
    ViewBag.Title = "Nueva Planilla";
}
<style>
    #ingresotabla td{line-height: 10px}
    #costotabla td{line-height: 10px}
    #gastotabla td{line-height: 10px}
    #otrotabla td{line-height: 10px}
    .table {
    margin-bottom: 8px;
}

</style>

<head>

    <link href="/Content/site.css" rel="stylesheet">
</head>
@*///////////////////////////*@
<hr style="margin-top: 10px;
                                       margin-bottom: 10px;" />

<legend style="margin-bottom: 2px;">
    Planilla: @ViewBag.nsheet
</legend>
<table id="titulotabla" class="table table-condensed table-bordered chica">

    <thead class="tableStyle">


        <tr class="text-center">
            <th class="text-center">
                Descripción
            </th>
            
            <th class="text-center">
                Fecha de creación
            </th>
        </tr>
    </thead>
    <tbody>
   
    <td class="text-center">
        <input type="text" class="panel-info form-control-sm inputForm" id="wdescription"  placeholder=""/>
    </td>
    <td class="text-center">
        <input type="date" class="panel-info form-control-sm inputForm" id="wdate" value="@DateTime.Now.ToString("yyyy-MM-dd")" placeholder="dd/mm/aaaa" />
    </td>
    </tbody>

</table>
<legend style="margin-bottom: 2px;">
    Ingresos
</legend>
<table id="ingresotabla" class="table table-condensed table-bordered chica">
    <thead>
        <tr class="text-center">
            <th class="text-center">
                Descripción
            </th>
            <th class="text-center">
                Observación
            </th>

            <th class="text-center">
                Monto
            </th>

            <th>Acción</th>
        </tr>
    </thead>
    <tbody id="ingreso">
    <td class="text-center fina">
        <input type="text" class="panel-info form-control-sm inputForm" id="idescription" placeholder="" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td class="text-center fina">
        <input type="text" class="panel-info form-control-sm inputForm" id="icomment" placeholder="" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td class="fina">
        <input type="number" class="panel-info form-control-sm inputForm" value="1" id="iamount" onkeypress="solonumerosptocoma();" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td class="fina">
        <button type="button" id="addi" class="btn btn-success btn-xs add" value="ingreso" />Agregar
        <span class="glyphicon glyphicon-plus"></span>
    </td>
    </tbody>

</table>
<legend style="margin-bottom: 2px;">
    Costos de las ventas
</legend>
<table id="costotabla" class="table table-condensed table-bordered chica">
    <thead class="tableStyle">
        <tr class="text-center">
            <th class="text-center">
                Descripción
            </th>
            <th class="text-center">
                Observación
            </th>

            <th class="text-center">
                Monto
            </th>

            <th>Acción</th>
        </tr>
    </thead>
    <tbody id="costo">
    <td class="text-center">
        <input type="text" class="panel-info form-control-sm inputForm" id="cdescription" placeholder="" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td class="text-center">
        <input type="text" class="panel-info form-control-sm inputForm" id="ccomment" placeholder="" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td>
        <input type="number" class="panel-info form-control-sm inputForm" value="1" id="camount" onkeypress="solonumerosptocoma();" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td>
        <button type="button" id="addc" class="btn btn-success btn-xs add" value="costo" />Agregar
        <span class="glyphicon glyphicon-plus"></span>
    </td>
    </tbody>

</table>
<legend style="margin-bottom: 2px;">
    Gastos
</legend>
<table id="gastotabla" class="table table-condensed table-bordered chica">
    <thead class="tableStyle">
        <tr class="text-center">
            <th class="text-center">
                Descripción
            </th>
            <th class="text-center">
                Observación
            </th>

            <th class="text-center">
                Monto
            </th>

            <th>Acción</th>
        </tr>
    </thead>
    <tbody id="gasto">
    <td class="text-center">
        <input type="text" class="panel-info form-control-sm inputForm" id="gdescription" placeholder="" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td class="text-center">
        <input type="text" class="panel-info form-control-sm inputForm" id="gcomment" placeholder="" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td>
        <input type="number" class="panel-info form-control-sm inputForm" value="1" id="gamount" onkeypress="solonumerosptocoma();" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td>
        <button type="button" id="addg" class="btn btn-success btn-xs add" value="gasto" />Agregar
        <span class="glyphicon glyphicon-plus"></span>
    </td>
    </tbody>

</table>
<legend style="margin-bottom: 2px;">
    Otros ingresos
</legend>
<table id="otrotabla" class="table table-condensed table-bordered chica">
    <thead class="tableStyle">
        <tr class="text-center">
            <th class="text-center">
                Descripción
            </th>
            <th class="text-center">
                Observación
            </th>
            
            <th class="text-center">
                Monto
            </th>
           
            <th>Acción</th>
        </tr>
    </thead>
    <tbody id="otro">
    <td class="text-center">
        <input type="text" class="panel-info form-control-sm inputForm" id="odescription" placeholder=""/>
        <span class="text-danger" style="display: block"></span>
    </td>
    <td class="text-center">
        <input type="text" class="panel-info form-control-sm inputForm" id="ocomment" placeholder="" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td>
        <input type="number" class="panel-info form-control-sm inputForm" value="1" id="oamount" onkeypress="solonumerosptocoma();" />
        <span class="text-danger" style="display: block"></span>
    </td>
    <td>
        <button type="button" id="addo" class="btn btn-success btn-xs add" value="otro" />Agregar
        <span class="glyphicon glyphicon-plus"></span>
    </td>
    </tbody>

</table>


<div>
    <div id="orderItemsi">
    </div>
    <span class="text-danger" style="display: block"></span>

</div>
<div>
    <div id="orderItemsc">
    </div>
    <span class="text-danger" style="display: block"></span>

</div>
<div>
    <div id="orderItemsg">
    </div>
    <span class="text-danger" style="display: block"></span>

</div>
<div>
    <div id="orderItemso">
    </div>
    <span class="text-danger" style="display: block"></span>

</div>
<legend style="margin-bottom: 2px;">
    Resumen
</legend>
<table id="resumentabla" class="table table-condensed   table-striped table-bordered chica">

    <thead class="tableStyle">
        <tr class="text-right">
            <td class="text-center" style="border-radius: 3px; font-weight: bold">
                Observaciones
            </td>
            <td class="text-center" style="border-radius: 3px; width: 200px; font-weight: bold">
                Total
            </td>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
                <textarea type="text" class="panel-info form-control-sm" id="wcomments"placeholder=""></textarea>

            </td>
            <td>
                <input type="text" class="panel-info text-center" value="0.00" id="wtotal" placeholder="" />
                <span class="text-danger" style="display: block"></span>
            </td>
        </tr>

    </tbody>

</table>

<hr style="color: grey" />


<div class="text-center">
    <button type="button" id="submit" class="btn btn-success btn-md" value="Guardar">
        Guardar
        <span class="glyphicon glyphicon-floppy-disk"></span>
    </button>
    <button type="button" id="imprimir" class="btn btn-success btn-md" value="Guardar">
        Guardar e Imprimir
        <span class="glyphicon glyphicon-floppy-disk"></span>
    </button>

</div>











@section Scripts{




   
    <script src="@Url.Content("~/Scripts/solonumerosptocoma.js")"></script>


    <script>

      

        $(document).ready(function() {
            var orderItems = [];
            var orderItemsi = [];
            var orderItemsc = [];
            var orderItemsg = [];
            var orderItemso = [];


            //////////ADD INGRESO///////////////
            ///////////////////////////
            //////////////////////
            //Add button click function
            $('#addi').click(function () {
                var isValidItem = true;
               
                //Check validation of order item
                if ($('#idescription').val().trim() == '') {
                    isValidItem = false;
                    $('#idescription').siblings('span.text-danger').html('Requerido');
                } else {
                    $('#idescription').siblings('span.text-danger').html('');
                }

                if ($('#iamount').val().trim() == '') {
                    isValidItem = false;
                    $('#iamount').siblings('span.text-danger').html('Requerido');
                } else {
                    $('#iamount').siblings('span.text-danger').html('');
                }
                

                if (isValidItem) {
                

                        var SheetDescriptioni = $('#idescription').val().trim();
                        var Amounti = $('#iamount').val().trim();
                        var Commentsi = $('#icomment').val().trim();
                        var SheetTypei = 0;
                        orderItemsi.push({
                            SheetDescription: SheetDescriptioni,
                            Amount: Amounti,
                            Comments: Commentsi,
                            SheetType: SheetTypei
                        });
                        
                        $('#idescription,#iamount,#icomment').val('');
                        ingreso();
                }


              

            });
            ///////ADD COSTO DE VENTAS///////
            /////////////////
            ////////////////
            ////////////////
            $('#addc').click(function () {
                var isValidItem = true; 

                if ($('#cdescription').val().trim() == '') {
                        isValidItem = false;
                        $('#cdescription').siblings('span.text-danger').html('Requerido');
                    } else {
                    $('#cdescription').siblings('span.text-danger').html('');
                    }

                if ($('#camount').val().trim() == '') {
                        isValidItem = false;
                        $('#camount').siblings('span.text-danger').html('Requerido');
                    } else {
                    $('#camount').siblings('span.text-danger').html('');
                    }
                

               

                if (isValidItem) {
                        var SheetDescriptionc = $('#cdescription').val().trim();
                        var Amountc = $('#camount').val().trim();
                        var Commentsc = $('#ccomment').val().trim();
                        var SheetTypec = 1;
                        orderItemsc.push({
                            SheetDescription: SheetDescriptionc,
                            Amount: Amountc,
                            Comments: Commentsc,
                            SheetType: SheetTypec
                        });
                        $('#cdescription,#camount,#ccomment').val('');
                        costo();
                }




            });
            /////////ADD GASTOS/////
            /////////////////
            ////////////////
            ////////////////
            $('#addg').click(function () {
                var isValidItem = true;
              
               

               
                    //Check validation of order item

                    if ($('#gdescription').val().trim() == '') {
                        isValidItem = false;
                        $('#gdescription').siblings('span.text-danger').html('Requerido');
                    } else {
                        $('#gdescription').siblings('span.text-danger').html('');
                    }

                    if ($('#gamount').val().trim() == '') {
                        isValidItem = false;
                        $('#gamount').siblings('span.text-danger').html('Requerido');
                    } else {
                        $('#gamount').siblings('span.text-danger').html('');
                   }
                

              

                if (isValidItem) {
                  
                   

                        var SheetDescriptiong = $('#gdescription').val().trim();
                        var Amountg = $('#gamount').val().trim();
                        var Commentsg = $('#gcomment').val().trim();
                        var SheetTypeg = 2;
                        orderItemsg.push({
                            SheetDescription: SheetDescriptiong,
                            Amount: Amountg,
                            Comments: Commentsg,
                            SheetType: SheetTypeg
                        });
                        $('#gdescription,#gamount,#gcomment').val('');
                        gasto();}




            });
            //////////////
            //////////ADD OTROS INGRESOS///////
            ////////////////
            ////////////////
            $('#addo').click(function () {
                var isValidItem = true;
            
             

             
                    if ($('#odescription').val().trim() == '') {
                        isValidItem = false;
                        $('#odescription').siblings('span.text-danger').html('Requerido');
                    } else {
                        $('#odescription').siblings('span.text-danger').html('');
                    }

                    if ($('#oamount').val().trim() == '') {
                        isValidItem = false;
                        $('#oamount').siblings('span.text-danger').html('Requerido');
                    } else {
                        $('#oamount').siblings('span.text-danger').html('');
                    }
                


                if (isValidItem) {
                  
                  
                        var SheetDescriptiono = $('#odescription').val().trim();
                        var Amounto = $('#oamount').val().trim();
                        var Commentso = $('#ocomment').val().trim();
                        var SheetTypeo = 3;
                        orderItemso.push({
                            SheetDescription: SheetDescriptiono,
                            Amount: Amounto,
                            Comments: Commentso,
                            SheetType: SheetTypeo
                        });
                        $('#odescription,#oamount,#ocomment').val('');
                        otro();

                }




            });
            //////////////
            /////////////////
            ////////////////
            ////////////////
            //Save button click function
            $('#submit').click(function() {
                //validation of order
                var isAllValid = true;
                //if (orderItems.length == 0) {
                //    $('#orderItems').html('<span class="text-danger">Por favor, agregue productos.</span>');
                //    isAllValid = false;
                //}


                if ($('#wdescription').val().trim() == '') {
                    $('#wdescription').siblings('span.error').css('visibility', 'visible');
                    isAllValid = false;
                } else {
                    $('#wdescription').siblings('span.error').css('visibility', 'hidden');
                }

                if ($('#wdate').val().trim() == '') {
                    $('#wdate').siblings('span.error').css('visibility', 'visible');
                    isAllValid = false;
                } else {
                    $('#wdate').siblings('span.error').css('visibility', 'hidden');
                }
                if ($('#wtotal').val().trim() == '') {
                    $('#wtotal').siblings('span.error').css('visibility', 'visible');
                    isAllValid = false;
                } else {
                    $('#wtotal').siblings('span.error').css('visibility', 'hidden');
                }
                
                orderItems = $.merge(orderItemsi,orderItemsc);
                orderItems = $.merge(orderItems,orderItemsg);
                orderItems = $.merge(orderItems,orderItemso);
                //Save if valid
                if (isAllValid) {
                    var data = {
                        WorksheetDescription: $('#wdescription').val().trim(),
                        Date: $('#wdate').val().trim(),
                        Comments: $('#wcomments').val().trim(),
                        Sheets: orderItems
                    }

                    $(this).val('Please wait...');

                    $.ajax({
                        url: '@Url.Action("CreateWorksheet", "Worksheets")',
                        type: "POST",
                        data: JSON.stringify(data),
                        dataType: "JSON",
                        contentType: "application/json",
                        success: function(d) {
                            //check is successfully save to database
                            if (d.status == true) {

                                var url = '@Url.Action("Details","Worksheets", new { id=ViewBag.nsheet})';
                                window.location.href = url;
                            } else {
                                alert('Failed');
                            }
                            $('#submit').val('Save');
                        },
                        error: function() {
                            alert('Error. Please try again.');
                            $('#submit').val('Save');
                        }
                    });
                }

            });

          

            function ingreso() {
                $('.elimi').remove();
                if (orderItemsi.length > 0) {
                    $('#orderItemsi').html('<span class="text-danger"></span>');
                $.each(orderItemsi, function (i, val) {
                    var $rowi = $('<tr class="elimi"  style="background-color: white"></tr>');
                    $rowi.append($('<td></td>').html(val.SheetDescription));
                    $rowi.append($('<td></td>').html(val.Comments));
                    $rowi.append($('<td></td>').html(val.Amount));
                    var $removei = $('<a href="#">Eliminar</a>');
                    //CALCULO TOTAL GRAL
                    //wtotal = 0;
                    //$.each(totgral, function () { wtotal += parseFloat(this) || 0; });
                    //document.getElementById("wtotal").value = wtotal.toFixed(2);
                    //FIN CALCULO TOTAL GRAL
                    $removei.click(function (e) {
                        e.preventDefault();
                        orderItemsi.splice(i, 1);
                        ingreso();
                    });
                    $rowi.append($('<td></td>').append($removei));
                    $('#ingresotabla > tbody:last').append($rowi);
                });
            } else {
                $('#orderItemsi').html('');
            }
            }

            function costo() {
                $('.elimc').remove();
                if (orderItemsc.length > 0) {
                    $('#orderItemsc').html('<span class="text-danger"></span>');
                    $.each(orderItemsc, function (i, val) {
                        var $rowc = $('<tr class="elimc"  style="background-color: white"></tr>');
                        $rowc.append($('<td></td>').html(val.SheetDescription));
                        $rowc.append($('<td></td>').html(val.Comments));
                        $rowc.append($('<td></td>').html(val.Amount));
                        var $removec = $('<a href="#">Eliminar</a>');
                        //CALCULO TOTAL GRAL
                        //wtotal = 0;
                        //$.each(totgral, function () { wtotal += parseFloat(this) || 0; });
                        //document.getElementById("wtotal").value = wtotal.toFixed(2);
                        //FIN CALCULO TOTAL GRAL
                        $removec.click(function (e) {
                            e.preventDefault();
                            orderItemsc.splice(i, 1);
                            costo();
                        });
                        $rowc.append($('<td></td>').append($removec));
                        $('#costotabla > tbody:last').append($rowc);
                    });
                } else {
                    $('#orderItemsc').html('');
                }
            }

            function gasto() {
                $('.elimg').remove();
                if (orderItemsg.length > 0) {
                    $('#orderItemsg').html('<span class="text-danger"></span>');
                    $.each(orderItemsg, function (i, val) {
                        var $rowg = $('<tr class="elimg"  style="background-color: white"></tr>');
                        $rowg.append($('<td></td>').html(val.SheetDescription));
                        $rowg.append($('<td></td>').html(val.Comments));
                        $rowg.append($('<td></td>').html(val.Amount));
                        var $removeg = $('<a href="#">Eliminar</a>');
                        //CALCULO TOTAL GRAL
                        //wtotal = 0;
                        //$.each(totgral, function () { wtotal += parseFloat(this) || 0; });
                        //document.getElementById("wtotal").value = wtotal.toFixed(2);
                        //FIN CALCULO TOTAL GRAL
                        $removeg.click(function (e) {
                            e.preventDefault();
                            orderItemsg.splice(i, 1);
                            gasto();
                        });
                        $rowg.append($('<td></td>').append($removeg));
                        $('#gastotabla > tbody:last').append($rowg);
                    });
                } else {
                    $('#orderItemsg').html('');
                }
            }

            function otro() {
                $('.elimo').remove();
                if (orderItemso.length > 0) {
                    $('#orderItemso').html('<span class="text-danger"></span>');
                    $.each(orderItemso, function (i, val) {
                        var $rowo = $('<tr class="elimo"  style="background-color: white"></tr>');
                        $rowo.append($('<td></td>').html(val.SheetDescription));
                        $rowo.append($('<td></td>').html(val.Comments));
                        $rowo.append($('<td></td>').html(val.Amount));
                        var $removeo = $('<a href="#">Eliminar</a>');
                        //CALCULO TOTAL GRAL
                        //wtotal = 0;
                        //$.each(totgral, function () { wtotal += parseFloat(this) || 0; });
                        //document.getElementById("wtotal").value = wtotal.toFixed(2);
                        //FIN CALCULO TOTAL GRAL
                        $removeo.click(function (e) {
                            e.preventDefault();
                            orderItemso.splice(i, 1);
                            otro();
                        });
                        $rowo.append($('<td></td>').append($removeo));
                        $('#otrotabla > tbody:last').append($rowo);
                    });
                } else {
                    $('#orderItemso').html('');
                }
            }



        });
    </script>
}

<style>
    /*Adding some css for looks good*/
    span.error {
        display: block;
        visibility: hidden;
        color: #b94a48;
        font-size: 90%;
    }


    /*css for table*/
    .container td {
        vertical-align: top;
    }

    .tablecontainer table {
        width: 100%;
        border-collapse: collapse;
        border-top: 1px solid #BFAEAE;
        border-right: 1px solid #BFAEAE;
    }

    .tablecontainer th {
        border-bottom: 2px solid #BFAEAE !important;
    }

    .tablecontainer th, .tablecontainer td {
        text-align: left;
        border-left: 1px solid #BFAEAE;
        padding: 5px;
        border-bottom: 1px solid #BFAEAE;
    }

    .ui-widget {
        font-size: 12px !important;
    }
</style>

